services:
  builder:
    build:
      context: builder
      dockerfile: Dockerfile
      args:
        OPENWRT_RELEASE: ${OPENWRT_RELEASE:-24.10.1}
        TARGET: ${TARGET:-x86}
        SUBTARGET: ${SUBTARGET-x64}
    command: ["/work/build-image.sh"]      # запустит сам скрипт
    environment:
      OPENWRT_RELEASE: ${OPENWRT_RELEASE}
      TARGET: ${TARGET}
      SUBTARGET: ${SUBTARGET}
      PROFILE: ${PROFILE}
      ROOTFS_SIZE: ${ROOTFS_SIZE}
      JOBS: ${JOBS:-$(nproc)}
    volumes:
      - ./packages.txt:/work/packages.txt:ro
      - ./output:/work/output
